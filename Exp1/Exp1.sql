create database library; use library;

CREATE TABLE PUBLISHER
(NAME VARCHAR(20) PRIMARY KEY, ADDRESS VARCHAR(50) NOT NULL, PHONE VARCHAR(10));
DESC PUBLISHER;

CREATE TABLE BOOK (BOOK_ID INT PRIMARY KEY,
TITLE VARCHAR(20) NOT NULL,
PUBLISHER_NAME VARCHAR(20) REFERENCES PUBLISHER(NAME) ON DELETE CASCADE, PUB_YEAR VARCHAR(5));
DESC BOOK;

CREATE TABLE BOOK_AUTHOR
(BOOK_ID INT REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, AUTHOR_NAME VARCHAR(20) NOT NULL,
PRIMARY KEY(BOOK_ID)); 
DESC BOOK_AUTHOR;

CREATE TABLE LIBRARY_BRANCH (BRANCH_ID INT PRIMARY KEY, BRANCH_NAME VARCHAR(20) NOT NULL, ADDRESS VARCHAR(50) );
DESC LIBRARY_BRANCH;

CREATE TABLE BOOK_LENDING
(BOOK_ID INT REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE,
BRANCH_ID INT REFERENCES LIBRARY_BRANCH(BRANCH_ID) ON DELETE CASCADE, CARD_NO INT NOT NULL,
DATE_OUT DATE NOT NULL, DUE_DATE DATE,
PRIMARY KEY(BOOK_ID,BRANCH_ID)); 
DESC BOOK_LENDING;

CREATE TABLE BOOK_COPIES
(BOOK_ID INT REFERENCES BOOK(BOOK_ID) ON DELETE CASCADE, BRANCH_ID INT REFERENCES LIBRARY_BRANCH(BRANCH_ID), NO_OF_COPIES INT,
PRIMARY KEY(BOOK_ID,BRANCH_ID) ); 
DESC BOOK_COPIES;

INSERT INTO PUBLISHER VALUES("PEARSON","NEW DELHI", 9996621456); INSERT INTO PUBLISHER VALUES("OXFORD","MUMBAI",9966884422);
INSERT INTO PUBLISHER VALUES("MC GRAW HILL","CHENNAI", 8866333444); INSERT INTO PUBLISHER VALUES("MACMILLAN","MANGALORE",9898989898); INSERT INTO PUBLISHER VALUES("CAMBRIDGE","BANGALORE",9876549876); SELECT * FROM PUBLISHER;

INSERT INTO BOOK VALUES(201,'DBMS','PEARSON','2015');
INSERT INTO BOOK VALUES(202,'PYTHON PROGRAMMING','OXFORD','2020'); 
INSERT INTO BOOK VALUES(203,'AI','MC GRAW HILL','2018');
INSERT INTO BOOK VALUES(204,'AUTOMATA THEORY','MACMILLAN','2014'); 
INSERT INTO BOOK VALUES(205,'ENTREPRENEURSHIP','CAMBRIDGE','2017'); SELECT * FROM BOOK;

INSERT INTO BOOK_AUTHOR VALUES(201,'NAVATHE'); 
INSERT INTO BOOK_AUTHOR VALUES(202,'AL SWEIGART'); 
INSERT INTO BOOK_AUTHOR VALUES(203,'SAROJ KAUSHIK'); 
INSERT INTO BOOK_AUTHOR VALUES(204,'ELAINE RICH'); 
INSERT INTO BOOK_AUTHOR VALUES(205,'TRIPATHI'); SELECT * FROM BOOK_AUTHOR;

INSERT INTO LIBRARY_BRANCH VALUES(101,'MANIPAL','UDUPI');
INSERT INTO LIBRARY_BRANCH VALUES(102,'MALLESHWARAM','BANGALORE'); 
INSERT INTO LIBRARY_BRANCH VALUES(103,'NEW ROAD','DELHI');
INSERT INTO LIBRARY_BRANCH VALUES(104,'LADYHILL','MANGALORE'); 
INSERT INTO LIBRARY_BRANCH VALUES(105,'DOLLARS COLONY','MYSORE'); SELECT * FROM LIBRARY_BRANCH;

INSERT INTO BOOK_LENDING VALUES(201,101,401,'2017-01-02','2017-02-02'); 
INSERT INTO BOOK_LENDING VALUES(202,101,401,'2017-01-07','2017-02-07'); 
INSERT INTO BOOK_LENDING VALUES(203,101,401,'2017-03-10','2017-04-10'); 
INSERT INTO BOOK_LENDING VALUES(204,101,401,'2017-05-20','2017-06-20'); 
INSERT INTO BOOK_LENDING VALUES(205,102,405,'2017-06-15','2017-07-15'); SELECT * FROM BOOK_LENDING;

INSERT INTO BOOK_COPIES VALUES(201,101,10); INSERT INTO BOOK_COPIES VALUES(202,101,35); 
INSERT INTO BOOK_COPIES VALUES(203,101,25); INSERT INTO BOOK_COPIES VALUES(203,102,15); 
INSERT INTO BOOK_COPIES VALUES(202,102,30); INSERT INTO BOOK_COPIES VALUES(201,105,45); SELECT * FROM BOOK_COPIES;

/*1. Retrieve details of all books in the library â€“ id, title, name of publisher, authors, number of copies in each branch, etc.*/

SELECT B.BOOK_ID, B.TITLE, B.PUBLISHER_NAME, A.AUTHOR_NAME,C.NO_OF_COPIES, L.BRANCH_ID
FROM BOOK B, BOOK_AUTHOR A, BOOK_COPIES C, LIBRARY_BRANCH L WHERE B.BOOK_ID=A.BOOK_ID AND B.BOOK_ID=C.BOOK_ID AND L.BRANCH_ID=C.BRANCH_ID ;

/*2. Get the particulars of borrowers who have borrowed more than 3 books, but from Jan 2017 to Jun 2017.*/

SELECT BL.CARD_NO FROM BOOK_LENDING BL WHERE DATE_OUT BETWEEN '2017- 01-01' AND '2017-07-01'
GROUP BY BL.CARD_NO HAVING COUNT(CARD_NO)>3;

/*3. Delete a book in BOOK table. Update the contents of other tables to
reflect this data manipulation operation. */

DELETE FROM BOOK WHERE BOOK_ID=203; SELECT * FROM BOOK;

/*4. Partition the BOOK table based on year of publication. Demonstrate its working with a simple query.*/

CREATE VIEW PUB_YEAR_VIEW AS SELECT PUB_YEAR FROM BOOK; SELECT * FROM PUB_YEAR_VIEW;

/*5. Create a view of all books and its number of copies that are currently available in the Library.*/

CREATE VIEW BK_COPIES_VIEW AS SELECT B.BOOK_ID, B.TITLE,C.NO_OF_COPIES FROM BOOK B,BOOK_COPIES C,LIBRARY_BRANCH L WHERE B.BOOK_ID=C.BOOK_ID AND C.BRANCH_ID=L.BRANCH_ID;
SELECT * FROM BK_COPIES_VIEW;


/*Query set 2*/

SELECT BOOK.BOOK_ID, TITLE, PUBLISHER_NAME, AUTHOR_NAME, NO_OF_COPIES, BRANCH_ID
FROM BOOK NATURAL JOIN BOOK_AUTHOR NATURAL JOIN BOOK_COPIES;


SELECT CARD_NO FROM BOOK_LENDING WHERE DATE_OUT BETWEEN '2017-01-01' AND '2017-07-01'
GROUP BY CARD_NO HAVING COUNT(*)>3;


DELETE FROM BOOK WHERE BOOK_ID=203; SELECT * FROM BOOK;
SELECT * FROM BOOK_AUTHOR; SELECT * FROM BOOK_COPIES; SELECT * FROM BOOK_LENDING;


CREATE VIEW YOP_VIEW AS SELECT BOOK_ID, TITLE, PUB_YEAR FROM BOOK ORDER BY PUB_YEAR;
SELECT * FROM YOP_VIEW;


CREATE VIEW BK_COPIES AS SELECT BOOK.BOOK_ID, TITLE, BRANCH_ID, NO_OF_COPIES FROM BOOK NATURAL JOIN BOOK_COPIES;
SELECT * FROM BK_COPIES;


