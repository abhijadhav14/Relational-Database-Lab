CREATE DATABASE MOVIES; USE MOVIES;

CREATE TABLE ACTOR( ACT_ID INT PRIMARY KEY, ACT_NAME VARCHAR(20), ACT_GENDER CHAR(6)); DESC ACTOR;

CREATE TABLE DIRECTOR( DIR_ID INT PRIMARY KEY, DIR_NAME VARCHAR(20), DIR_PHONE BIGINT);
DESC DIRECTOR;

CREATE TABLE MOVIES( MOV_ID INT PRIMARY KEY, MOV_TITLE VARCHAR(20), MOV_YEAR INT,
MOV_LANG VARCHAR(20), DIR_ID INT,
FOREIGN KEY(DIR_ID) REFERENCES DIRECTOR(DIR_ID)); DESC MOVIES;

CREATE TABLE MOVIE_CAST( ACT_ID INT,
MOV_ID INT,
ROLE VARCHAR(10),
PRIMARY KEY(ACT_ID, MOV_ID),
FOREIGN KEY(ACT_ID) REFERENCES ACTOR(ACT_ID), FOREIGN KEY(MOV_ID) REFERENCES MOVIES(MOV_ID)); DESC MOVIE_CAST;

CREATE TABLE RATING( MOV_ID INT PRIMARY KEY, REV_STARS FLOAT,
FOREIGN KEY(MOV_ID) REFERENCES MOVIES(MOV_ID)); DESC RATING;

INSERT INTO ACTOR VALUES(101,'ROWAN ATKINSON','M'); 
INSERT INTO ACTOR VALUES(102,'ELIZABETH','F'); 
INSERT INTO ACTOR VALUES(103,'RAJINIKANTH','M'); 
INSERT INTO ACTOR VALUES(104,'NEOLA JANE','F'); 
INSERT INTO ACTOR VALUES(105,'RISHAB SHETTY','M'); 
INSERT INTO ACTOR VALUES(106,'ANSEL ELGORT','M'); 
INSERT INTO ACTOR VALUES(107,'LAURA','F');
SELECT * FROM ACTOR;

INSERT INTO DIRECTOR VALUES(201,'HITCHCOCK',9681855818); 
INSERT INTO DIRECTOR VALUES(202,'PREETHAM',9866448172);
INSERT INTO DIRECTOR VALUES(203,'STEVEN SPIELBERG',9887541234); 
INSERT INTO DIRECTOR VALUES(204,'SHANKAR',9478653428);
INSERT INTO DIRECTOR VALUES(205,'RAJAMOULI',9578653089); 
SELECT * FROM DIRECTOR;

INSERT INTO MOVIES VALUES(301,'REAR WINDOW',1954,'ENGLISH',201); 
INSERT INTO MOVIES VALUES(302,'PADAYAPPA',2021,'TAMIL',202); 
INSERT INTO MOVIES VALUES(303,'SUSPICION',1941,'ENGLISH',201); 
INSERT INTO MOVIES VALUES(304,'SHIVAJI',2007,'TAMIL',204); 
INSERT INTO MOVIES VALUES(305,'BAHUBALI',2015,'TELUGU',205);
INSERT INTO MOVIES VALUES(306,'WEST SIDE STORIES',2020,'ENGLISH',203); 
INSERT INTO MOVIES VALUES(307,'JURASSIC PARK',1993,'ENGLISH',203); 
SELECT * FROM MOVIES;

INSERT INTO MOVIE_CAST VALUES(101,301,'GUEST'); 
INSERT INTO MOVIE_CAST VALUES(101,303,'VILLAIN'); 
INSERT INTO MOVIE_CAST VALUES(102,303,'HEROINE'); 
INSERT INTO MOVIE_CAST VALUES(103,304,'HERO'); 
INSERT INTO MOVIE_CAST VALUES(104,301,'HEROINE'); 
INSERT INTO MOVIE_CAST VALUES(106,306,'CAMEO'); 
INSERT INTO MOVIE_CAST VALUES(107,307,'HEROINE'); 
SELECT * FROM MOVIE_CAST;

INSERT INTO RATING VALUES(301,3.5); 
INSERT INTO RATING VALUES(302,5); 
INSERT INTO RATING VALUES(303,4.5); 
INSERT INTO RATING VALUES(304,2.5); 
INSERT INTO RATING VALUES(305,5); 
INSERT INTO RATING VALUES(306,3.5); INSERT INTO RATING VALUES(307,3); 
SELECT * FROM RATING;

/*1. List the titles of all movies directed by ‘Hitchcock’:*/
SELECT MOV_TITLE FROM MOVIES WHERE
DIR_ID = (SELECT DIR_ID FROM DIRECTOR WHERE DIR_NAME='HITCHCOCK');

/*2.Find the movie names where one or more actors acted in two or more movies:*/

SELECT DISTINCT MOV_TITLE FROM MOVIES M NATURAL JOIN MOVIE_CAST WHERE ACT_ID IN
(SELECT ACT_ID FROM MOVIE_CAST GROUP BY ACT_ID HAVING COUNT(*)>=2);

/*3.List all actors who acted in a movie before 2000 and also in a movie after 2015 (use JOIN operation):*/

SELECT DISTINCT ACT_NAME FROM ACTOR JOIN MOVIE_CAST USING(ACT_ID)
JOIN MOVIES USING(MOV_ID)
WHERE MOV_YEAR NOT BETWEEN 2005 AND 2015;

/*4.Find the title of movies and number of stars for each movie that has at least one rating and find the highest number of stars that movie received. Sort the result by movie title:*/

SELECT MOV_TITLE MOVIE_NAME, MAX(REV_STARS) RATING FROM MOVIES INNER JOIN RATING USING(MOV_ID)
GROUP BY MOV_TITLE HAVING MAX(REV_STARS)>0 ORDER BY MOV_TITLE;

/*5.Update the rating of all movies directed by ‘Steven Spielberg’ to 5:*/

UPDATE RATING SET REV_STARS=5 WHERE MOV_ID IN
(SELECT MOV_ID FROM MOVIES WHERE DIR_ID IN
(SELECT DIR_ID FROM DIRECTOR WHERE DIR_NAME='STEVEN SPIELBERG')); SELECT * FROM RATING;


/*QuerySet 2*/

SELECT MOV_TITLE MOVIES_BY_HITCHCOCK FROM MOVIES WHERE DIR_ID IN
(SELECT DIR_ID FROM DIRECTOR WHERE DIR_NAME="HITCHCOCK");


SELECT DISTINCT MOV_TITLE
FROM MOVIES NATURAL JOIN MOVIE_CAST WHERE ACT_ID IN
(SELECT ACT_ID FROM MOVIE_CAST GROUP BY ACT_ID HAVING COUNT(*)>=2);


SELECT DISTINCT ACT_NAME ACTORS
FROM ACTOR JOIN MOVIE_CAST USING(ACT_ID)
JOIN MOVIES USING (MOV_ID) WHERE MOV_YEAR NOT BETWEEN '2000' AND '2015';


SELECT MOV_TITLE MOVIE, MAX(REV_STARS) RATING FROM MOVIES INNER JOIN RATING USING(MOV_ID)
GROUP BY MOV_TITLE HAVING MAX(REV_STARS)>0 ORDER BY MOV_TITLE;


UPDATE RATING SET REV_STARS=5 WHERE MOV_ID IN (SELECT MOV_ID FROM MOVIES WHERE DIR_ID IN
(SELECT DIR_ID FROM DIRECTOR WHERE DIR_NAME="STEVEN SPIELBERG")); SELECT * FROM RATING;

